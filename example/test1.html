<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>test vue</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router@3.6.5/dist/vue-router.js"></script>
  </head>
  <body>
    <div id="app">
      <router-link to="/page1">Go to page1</router-link>
      <router-link to="/page2">Go to page2</router-link>
      <router-link to="/page3">Go to page3</router-link>
      <router-link to="/bar">Go to Bar</router-link>
      <router-view></router-view>
      <component :is="layout" :page="page"></component>
    </div>
    <script>
    const layout1 = {
      props:['nav','page'],
      template:`<div>
        <header>layout 1</header>
        <div>
          <aside>aside:{{nav}}</aside>
          <main>
            <component :is="page" />
          </main>
        </div>
        </div>`,
    }
    const layout2 = {
      props:['nav','page'],
      template:`<div>
        <header>layout 2</header>
        <container>
          <aside>aside:{{nav}}</aside>
          <main>
            <component :is="page" />
          </main>
        </container>
        </div>`,
    }
    const page1 = {
      template:`<div>page 1 </div>`,
    }
    const page2 = {
      template:`<div>page 2</div>`,
    }
    const page3= {
      template:`<div>page 3</div>`,
    }
    const page4= {
      template:`<div>page 4</div>`,
    }
    const LoadingComponent = {
      template: '<div>loading....</div>'
    }
    const ErrorComponent = {
      template: '<div>loading error</div>'
    }
    </script>
    <script>
      Vue.component("LoadingComponent",LoadingComponent)
      Vue.component("ErrorComponent",ErrorComponent)
      Vue.component("layout1",layout1)
      Vue.component("page1",page1)
      Vue.component("page1",page1)
      Vue.component("page2",page2)
      function lazyLoadView () {
        const AsyncHandler = () => ({
          // 需要加载的组件 (应该是一个 `Promise` 对象)
          component: new Promise((resolve,reject)=>{
            setTimeout(()=>{
              resolve({
                template: '<div>I am async! 111</div>',
              })
            },2000)
          }),

          // 异步组件加载时使用的组件
          loading: LoadingComponent,
          // 加载失败时使用的组件
          error: ErrorComponent,
          // 展示加载时组件的延时时间。默认值是 200 (毫秒)
          delay: 200,
          // 如果提供了超时时间且组件加载也超时了，
          // 则使用加载失败时使用的组件。默认值是：`Infinity`
          timeout: 3000,
        })
        return Promise.resolve({
          functional: true,
          render (h, { data, children }) {
            // Transparently pass any props or children
            // to the view component.
            return h(AsyncHandler, data, children)
          },
          beforeRouteEnter(to, from, next) {
            console.log(">>>>>>>>>>>>>>beforeRouteEnter:",to)
            // 在渲染该组件的对应路由被 confirm 前调用
            // 不！能！获取组件实例 `this`
            // 因为当守卫执行前，组件实例还没被创建
            next((vm)=>{
              console.log(">>>>>>>>>>>>>beforeRouteEnter next")
            })
          },
          beforeRouteUpdate(to, from, next) {
            console.log(">>>>>>>>>>>>>>beforeRouteUpdate:",to)
            // 在当前路由改变，但是该组件被复用时调用
            // 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，
            // 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。
            // 可以访问组件实例 `this`
            next()
          },
          beforeRouteLeave(to, from, next) {
            console.log(">>>>>>>>>>>>>>beforeRouteLeave:",to)
            next()
            // 导航离开该组件的对应路由时调用
            // 可以访问组件实例 `this`
          },
        })
      }
      const asyncRoute = {
        path: '/page1',
        // path: '*',
        component:()=>lazyLoadView(),
        beforeEnter: (to, from, next) => {
          console.log(">>>>>>>>>>>>>>beforeEnter:",to)
          // if(isFirst){
          //   isFirst = false
          //   return
          // }
          next()
        }
      }
      const datas = {
        layout:'layout1',
        page:'page1'
      }
      const isFirst = true
      const router = new VueRouter({
        mode: 'history',
        routes:[
          {
            path: '/page2',
            component:page2,
          },
          // asyncRoute,
          {
            path: '*',
            component:{
              template: '<div>User</div>',
            },
             beforeEnter: (to, from, next) => {
              console.log(">>>>>>>>>>>>>>*  beforeEnter:",to)
              // next()
            }
          }
        ]
      })
      const app = new Vue({
        el:'#app',
        router,
        data(){
          return datas
        }
      })
    </script>
  </body>
</html>